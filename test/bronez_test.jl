
# Example data for computing spectra with unequal spacing

using Multitaper, Distributions

t = collect(1:1000).^(1.05)
w = 0.008
K = 5
Distributions.Random.seed!(123)

lamc, slepsc = gpss_orth(w, K, t, 0.0)
t = collect(1:256) .^ (1.05)
x = sin.(2 * pi * 0.01 * t) + randn(256)
y = x .* (1 .+ cos.(2 * pi * 0.05 * t))
Sxy = bspec(t, hcat(x, y), w, K, 0.5, 0.0)

@testset "Generalized Slepians" begin

  # concentrations
  @test lamc ≈ [1.000000000000002, 1.0000000000000018, 1.0000000000000016, 1.0000000000000004, 1.0000000000000002]  

  @test slepsc[1:5,:] ≈ Complex{Float64}[4.2409565577469207e-10 + 0.0im 6.763170576442219e-10 + 0.0im -1.3211647149247903e-9 + 0.0im 1.1483204629618572e-10 + 0.0im 2.945892749279523e-10 + 0.0im; 6.833599101547575e-10 + 0.0im 1.0591506336799174e-9 + 0.0im -2.0649741404287993e-9 + 0.0im 2.2264933068877912e-10 + 0.0im 4.6092237260141004e-10 + 0.0im; 1.0434133434488493e-9 + 0.0im 1.5831454610204672e-9 + 0.0im -3.083191653122788e-9 + 0.0im 3.8092881622512536e-10 + 0.0im 6.891083452467861e-10 + 0.0im; 1.5036604986736549e-9 + 0.0im 2.2396467701515826e-9 + 0.0im -4.358694907837402e-9 + 0.0im 5.983967936246794e-10 + 0.0im 9.75191227153913e-10 + 0.0im; 2.1068337327480575e-9 + 0.0im 3.089010620527238e-9 + 0.0im -6.009470205377686e-9 + 0.0im 8.953898832143693e-10 + 0.0im 1.345999005063014e-9 + 0.0im]

end

@testset "Univariate bronez" begin

  # frequency
  @test Sxy[1][1].f[1:5] ≈[0.0, 0.00390625, 0.0078125, 0.01171875, 0.015625]

  # spectrum
  @test Sxy[1][1].S[1:5] ≈[0.2229895903809905, 2.77553021415981, 2.5709182628017366, 2.454698304150587, 2.928010077620479]
  
end

@testset "Multivariate bronez" begin

  # coherence
  @test Sxy[2][1, 2].coh[1:5] ≈[3.653220219379243, 5.984701622401609, 4.334558192175212, 4.35180146081882, 4.427408561605233]

  # phase
  @test Sxy[2][1, 2].phase[1:5] ≈ [1.2993305587492667, 0.8688570599743293, 0.8149249518116952, 0.7286696502765846, 0.8081100746207301]

end

